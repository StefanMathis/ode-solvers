<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Sylvain Renevey">
        <link rel="canonical" href="https://srenevey.github.io/ode-solvers/examples/three_body_problem.html">
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Three-body Problem - Ode-solvers Docs</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/docco.min.css">

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../index.html">Ode-solvers Docs</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href="../index.html" class="nav-link">Quick reference</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="kepler_orbit.html" class="dropdown-item">Kepler Orbit</a>
</li>
                                    
<li>
    <a href="three_body_problem.html" class="dropdown-item active">Three-body Problem</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="https://docs.rs/ode_solvers/" class="nav-link">API documentation</a>
                            </li>
                            <li class="navitem">
                                <a href="../changelog.html" class="nav-link">Changelog</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="kepler_orbit.html" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../changelog.html" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="https://github.com/srenevey/ode-solvers" class="nav-link"><i class="fa fa-github"></i> GitHub</a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#three-body-problem" class="nav-link">Three-Body Problem</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#problem-definition" class="nav-link">Problem Definition</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#implementation" class="nav-link">Implementation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#results" class="nav-link">Results</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="three-body-problem">Three-Body Problem</h1>
<h2 id="problem-definition">Problem Definition</h2>
<p>In this problem, we consider the circular restricted three body problem in which a spacecraft evolves under the influence of the Earth and the Moon. The second order nondimensional equations of motion of this problem are</p>
<p>
<script type="math/tex; mode=display">\ddot{x}-2\dot{y}-x = -\frac{(1-\mu)(x+\mu)}{d^3}-\frac{\mu(x-1+\mu)}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\ddot{y}+2\dot{x}-y = -\frac{(1-\mu)y}{d^3}-\frac{\mu y}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\ddot{z} = -\frac{(1-\mu)z}{d^3}-\frac{\mu z}{r^3}</script>
</p>
<p>where</p>
<p>
<script type="math/tex; mode=display">d=\left[(x+\mu)^2+y^2+z^2\right]^{\frac{1}{2}}</script>
</p>
<p>
<script type="math/tex; mode=display">r=\left[(x-1+\mu)^2+y^2+z^2\right]</script>
</p>
<p>
<script type="math/tex">\mu</script> is a parameter of the system. For the Earth-Moon system, <script type="math/tex">\mu=0.0123</script>. Rewriting this system in state space form yields</p>
<p>
<script type="math/tex; mode=display">\dot{x}_1=x_4</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_2=x_5</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_3=x_6</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_4=x_1+2x_5-\frac{(1-\mu)(x_1+\mu)}{d^3}-\frac{\mu(x_1-1+\mu)}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_5=-2x_4+x_2-\frac{(1-\mu)x_2}{d^3}-\frac{\mu x_2}{r^3}</script>
</p>
<p>
<script type="math/tex; mode=display">\dot{x}_5=-\frac{(1-\mu)x_3}{d^3}-\frac{\mu x_3}{r^3}</script>
</p>
<h2 id="implementation">Implementation</h2>
<p>The problem is solved using Dop853. The crate is first imported and the modules are brought into scope:</p>
<pre><code class="language-Rust">use ode_solvers::dop853::*;
use ode_solvers::*;
</code></pre>
<p>Type aliases are then defined for the state vector and the time:</p>
<pre><code class="language-Rust">type State = Vector6&lt;f64&gt;;
type Time = f64;
</code></pre>
<p>Next, we define the problem specific structure which will contain a single parameter:</p>
<pre><code class="language-rust">struct ThreeBodyProblem {
  mu: f64,
}
</code></pre>
<p>for which we implement the <code>System&lt;V&gt;</code> trait:</p>
<pre><code class="language-Rust">impl ode_solvers::System&lt;State&gt; for ThreeBodyProblem {
    fn system(&amp;self, _t: Time, y: &amp;State, dy: &amp;mut State) {
        let d = ((y[0] + self.mu).powi(2) + y[1].powi(2) + y[2].powi(2)).sqrt();
        let r = ((y[0] - 1.0 + self.mu).powi(2) + y[1].powi(2) + y[2].powi(2)).sqrt();

        dy[0] = y[3];
        dy[1] = y[4];
        dy[2] = y[5];
        dy[3] = y[0] + 2.0 * y[4]
            - (1.0 - self.mu) * (y[0] + self.mu) / d.powi(3)
            - self.mu * (y[0] - 1.0 + self.mu) / r.powi(3);
        dy[4] = -2.0 * y[3] + y[1] - (1.0 - self.mu) * y[1] / d.powi(3) - self.mu * y[1] / r.powi(3);
        dy[5] = -(1.0 - self.mu) * y[2] / d.powi(3) - self.mu * y[2] / r.powi(3);
    }
}
</code></pre>
<p>The system is created together with the intial state vector of the spacecraft in the <em>main</em> function. A Dop853 structure is created and the <em>integrate()</em> function is called. The result is handled with a <em>match</em> statement.</p>
<pre><code class="language-Rust">fn main() {
    let system = ThreeBodyProblem {mu: 0.012300118882173};

    let y0 = State::new(-0.271, -0.42, 0.0, 0.3, -1.0, 0.0);

    let mut stepper = Dop853::new(system, 0.0, 150.0, 0.001, y0, 1.0e-14, 1.0e-14);
    let res = stepper.integrate();

    // Handle result
    match res {
        Ok(stats) =&gt; {
            stats.print();
            // Do something with the results...
            // let path = Path::new(&quot;./outputs/three_body_dop853.dat&quot;);
            // save(stepper.x_out(), stepper.y_out(), path);  
            // println!(&quot;Results saved in: {:?}&quot;, path);
        },
        Err(_) =&gt; println!(&quot;An error occured.&quot;),
    }
}
</code></pre>
<h2 id="results">Results</h2>
<p>The trajectory of the spacecraft for a duration of 150 (dimensionless time) is shown on the following figure:</p>
<p><center><img alt="Three body problem" src="images/three_body_dop853.png" /></center></p>
<p>On that figure, the Earth is located at (0, 0) and the Moon is at (0.9877, 0). We see that the spacecraft is first on an orbit about the Earth before moving to the vicinity of the Moon. The accuracy of the integration can be assessed by looking at the Jacobi constant. The Jacobi constant is given by</p>
<p><center><script type="math/tex; mode=display">C=\frac{2(1-\mu)}{d} + \frac{2\mu}{r} + x^2 +y^2 - v^2</script></center></p>
<p>and is an integral of the motion (i.e. is constant as long as no external force is applied). Based on the initial conditions, the Jacobi constant yields</p>
<p><center><script type="math/tex; mode=display">C_0=3.1830</script></center></p>
<p>By computing the Jacobi constant at each time step and plotting the difference <script type="math/tex">C-C_0</script>, we get the figure below:</p>
<p><center><img alt="Error on the Jacobi constant" src="images/err_jacobi_dop853.png" /></center></p>
<p>As can be seen on that figure, the Jacobi constant is constant up to the 11th digit after the decimal point. This accuracy is quite reasonable for that kind of problem but if a higher accuracy is required, the relative tolerance and/or the absolute tolerance could be reduced.</p></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
